// @ts-nocheck
document.addEventListener("DOMContentLoaded",(()=>{const n=document.getElementById("character-select"),e=document.getElementById("variant-select"),t=document.getElementById("variant-container"),a=document.getElementById("animations-container"),i=document.getElementById("loading"),r={};let o=[];async function p(n){try{if(a.innerHTML="",r[n])return void c(n,r[n].animations,r[n].spriteImage);const e=await async function(n){try{const e=await fetch(`Animations/${n}.json`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return function(n){const e=n.replace(/,(\s*[\}\]])/g,"$1");return JSON.parse(e)}(await e.text())}catch(e){throw console.error(`加载 ${n} 的动画配置失败:`,e),e}}(n),t=await async function(n){return new Promise(((e,t)=>{const a=new Image;a.src=`Characters/${n}.png`,a.onload=()=>e(a),a.onerror=()=>{console.error(`加载精灵图 ${n}.png 失败`),t(new Error(`加载精灵图 ${n}.png 失败`))}}))}(n);r[n]={animations:e,spriteImage:t},c(n,e,t)}catch(e){console.error(`加载角色 ${n} 的动画失败:`,e),a.innerHTML=`<div class="error">加载角色 ${n} 的动画失败。</div>`}}function c(n,e,t){if(!e||0===e.length)return void(a.innerHTML=`<div class="error">没有找到 ${n} 的动画。</div>`);e.forEach((e=>{const i=document.createElement("div");i.className="animation-box";const r=document.createElement("div");r.className="animation-title",r.textContent=e.animation;const o=document.createElement("div");o.className="sprite-container";const p=document.createElement("div");p.className="sprite",p.style.width=`${t.width}px`,p.style.height=`${t.height}px`,p.style.backgroundImage=`url(Characters/${n}.png)`,o.appendChild(p),i.appendChild(r),i.appendChild(o),a.appendChild(i),function(n,e,t,a,i){let r,o=0;n.dataset.intervalId&&clearInterval(parseInt(n.dataset.intervalId));r=setInterval((()=>{const r=e[o],p=Math.floor(r/i),c=r%i;n.style.backgroundPosition=`-${c*t}px -${p*a}px`,o=(o+1)%e.length}),200),n.dataset.intervalId=r}(p,e.frames,16,32,4)}))}function g(n){i.style.display=n?"block":"none"}!async function(){try{o=await async function(){try{return["Abigail_Beach.png","Abigail_Winter.png","Abigail.png","Alex_Beach.png","Alex_Winter.png","Alex.png","Birdie.png","Caroline_Beach.png","Caroline_Winter.png","Caroline.png","Clint_Beach.png","Clint_Winter.png","Clint.png","Demetrius_Winter.png","Demetrius.png","Elliott_Beach.png","Elliott_Winter.png","Elliott.png","Emily_Beach.png","Emily_Winter.png","Emily.png","Evelyn_Winter.png","Evelyn.png","George_Winter.png","George.png","Gus_Winter.png","Gus.png","Haley_Beach.png","Haley_Winter.png","Haley.png","Harvey_Beach.png","Harvey_Winter.png","Harvey.png","Jas_Winter.png","Jas.png","Jodi_Beach.png","Jodi_Winter.png","Jodi.png","Kent_Winter.png","Kent.png","Leah_Beach.png","Leah_Winter.png","Leah.png","Lewis_Beach.png","Lewis_Winter.png","Lewis.png","Linus_Winter.png","Linus.png","Marnie_Beach.png","Marnie_Winter.png","Marnie.png","Maru_Beach.png","Maru_Hospital.png","Maru_Winter.png","Maru.png","Morris.png","Pam_Beach.png","Pam_Winter.png","Pam.png","ParrotBoy_Winter.png","ParrotBoy.png","Penny_Beach.png","Penny_Winter.png","Penny.png","Pierre_Beach.png","Pierre_Winter.png","Pierre.png","Robin_Beach.png","Robin_Winter.png","Robin.png","SafariGuy.png","Sam_Beach.png","Sam_JojaMart.png","Sam_Winter.png","Sam.png","Sandy.png","Sebastian_Beach.png","Sebastian_Winter.png","Sebastian.png","Shane_Beach.png","Shane_JojaMart.png","Shane_Winter.png","Shane.png","Vincent_Winter.png","Vincent.png","Willy_Winter.png","Willy.png","Wizard.png"]}catch(n){return console.error("获取角色列表失败:",n),[]}}();const e=new Set;o.forEach((n=>{const t=n.replace(".png","").split("_");1===t.length&&e.add(t[0])}));Array.from(e).sort().forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e,n.appendChild(t)}))}catch(e){console.error("获取角色列表失败:",e),["Abigail","Alex","Emily","Sebastian"].forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e,n.appendChild(t)}))}}(),n.addEventListener("change",(async()=>{const i=n.value;if(!i)return a.innerHTML="",void(t.style.display="none");!function(n){e.value="",t.style.display="none";const a=o.includes(`${n}_Beach.png`),i=o.includes(`${n}_Winter.png`),r=o.includes(`${n}_JojaMart.png`),p=o.includes(`${n}_Hospital.png`);if(a||i||r||p){for(t.style.display="inline-block";e.options.length>1;)e.remove(1);if(a){const n=document.createElement("option");n.value="Beach",n.textContent="海滩",e.appendChild(n)}if(i){const n=document.createElement("option");n.value="Winter",n.textContent="冬季",e.appendChild(n)}if(r){const n=document.createElement("option");n.value="JojaMart",n.textContent="Joja超市",e.appendChild(n)}if(p){const n=document.createElement("option");n.value="Hospital",n.textContent="医院",e.appendChild(n)}}}(i),g(!0),await p(i),g(!1)})),e.addEventListener("change",(async()=>{const t=n.value,a=e.value;t&&(g(!0),a?await p(`${t}_${a}`):await p(t),g(!1))}))}));