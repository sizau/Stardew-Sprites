// @ts-nocheck
document.addEventListener("DOMContentLoaded",(()=>{const n=document.getElementById("character-select"),e=document.getElementById("animations-container"),t=document.getElementById("loading"),a={};function o(n,t,a){if(!t||0===t.length)return void(e.innerHTML=`<div class="error">没有找到 ${n} 的动画。</div>`);const o=a.width/4,r=a.height/4;t.forEach((t=>{const i=document.createElement("div");i.className="animation-box";const c=document.createElement("div");c.className="animation-title",c.textContent=t.animation;const s=document.createElement("div");s.className="sprite-container";const d=document.createElement("div");d.className="sprite",d.style.width=`${a.width}px`,d.style.height=`${a.height}px`,d.style.backgroundImage=`url(Characters/${n}.png)`,s.appendChild(d),i.appendChild(c),i.appendChild(s),e.appendChild(i),function(n,e,t,a){let o=0;setInterval((()=>{const r=e[o],i=Math.floor(r/4),c=r%4;n.style.backgroundPosition=`-${c*t}px -${i*a}px`,o=(o+1)%e.length}),200)}(d,t.frames,o,r)}))}function r(n){t.style.display=n?"block":"none"}!async function(){try{const e=await async function(){try{const n=await fetch("characters-list.php");if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);return await n.json()}catch(n){return console.error("获取角色列表失败:",n),["Abigail.png","Alex.png","Haley.png","Sebastian.png"]}}(),t=new Set;e.forEach((n=>{const e=n.replace(".png","");t.add(e)}));Array.from(t).sort().forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e,n.appendChild(t)}))}catch(n){console.error("获取角色列表失败:",n)}}(),n.addEventListener("change",(async()=>{const t=n.value;t?(r(!0),await async function(n){try{if(e.innerHTML="",a[n])return void o(n,a[n].animations,a[n].spriteImage);const t=await async function(n){try{const e=await fetch(`load-animation.php?character=${encodeURIComponent(n)}`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return await e.json()}catch(e){return console.error(`加载 ${n} 的动画配置失败:`,e),"Abigail"===n?[{animation:"AnimateDown",frames:[0,1,2,3],eventId:""},{animation:"AnimateRight",frames:[4,5,6,7],eventId:""},{animation:"AnimateUp",frames:[8,9,10,11],eventId:""},{animation:"AnimateLeft",frames:[12,13,14,15],eventId:""}]:[]}}(n),r=await async function(n){return new Promise(((e,t)=>{const a=new Image;a.src=`Characters/${n}.png`,a.onload=()=>e(a),a.onerror=()=>{console.error(`加载精灵图 ${n}.png 失败`),t(new Error(`加载精灵图 ${n}.png 失败`))}}))}(n);a[n]={animations:t,spriteImage:r},o(n,t,r)}catch(t){console.error(`加载角色 ${n} 的动画失败:`,t),e.innerHTML=`<div class="error">加载角色 ${n} 的动画失败。</div>`}}(t),r(!1)):e.innerHTML=""}))}));