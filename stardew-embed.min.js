// @ts-nocheck
!function(){async function e(e,t){try{t.innerHTML="";const a=await async function(e){try{const t=await fetch(`Animations/${e}.json`);if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);return function(e){const t=e.replace(/,(\s*[\}\]])/g,"$1");return JSON.parse(t)}(await t.text())}catch(t){throw console.error(`加载 ${e} 的动画配置失败:`,t),t}}(e),n=await async function(e){return new Promise(((t,a)=>{const n=new Image;n.src=`Characters/${e}.png`,n.onload=()=>t(n),n.onerror=()=>a(new Error(`加载精灵图 ${e}.png 失败`))}))}(e);!function(e,t,a,n){if(!t||0===t.length)return void(n.innerHTML=`<div class="stardew-embed-error">没有找到 ${e} 的动画。</div>`);const s=16,r=32,d=4;t.forEach((t=>{const i=document.createElement("div");i.className="stardew-embed-animation";const l=document.createElement("div");l.className="stardew-embed-animation-title",l.textContent=t.animation;const c=document.createElement("div");c.className="stardew-embed-sprite-container";const o=document.createElement("div");o.className="stardew-embed-sprite",o.style.width=`${a.width}px`,o.style.height=`${a.height}px`,o.style.backgroundImage=`url(Characters/${e}.png)`,c.appendChild(o),i.appendChild(l),i.appendChild(c),n.appendChild(i),i.title=t.animation,function(e,t,a,n,s){let r,d=0;e.dataset.intervalId&&clearInterval(parseInt(e.dataset.intervalId));r=setInterval((()=>{const r=t[d],i=Math.floor(r/s),l=r%s;e.style.backgroundPosition=`-${l*a}px -${i*n}px`,d=(d+1)%t.length}),200),e.dataset.intervalId=r}(o,t.frames,s,r,d)}))}(e,a,n,t)}catch(e){console.error(`加载动画失败: ${e.message}`),t.innerHTML=`<div class="stardew-embed-error">加载动画失败: ${e.message}</div>`}}document.addEventListener("DOMContentLoaded",(()=>{const t=document.querySelectorAll("#stardew-character-player, [data-stardew-character]");0!==t.length?t.forEach((t=>{!function(t){const a=t.dataset.character||t.dataset.stardewCharacter;if(!a)return void(t.innerHTML='<div class="stardew-embed-error">未指定角色名称</div>');console.log(`初始化角色播放器: ${a}`),function(e,t){e.classList.add("stardew-embed"),e.innerHTML=`\n            <div class="stardew-embed-container">\n                <div class="stardew-embed-sidebar">\n                    <h3 class="stardew-embed-title">${t}</h3>\n                    <ul class="stardew-embed-variants">\n                        <li class="stardew-embed-variant-item active" data-variant="">默认</li>\n                        \x3c!-- 变体选项将由JS动态添加 --\x3e\n                    </ul>\n                </div>\n                <div class="stardew-embed-content">\n                    <div class="stardew-embed-loading">加载中...</div>\n                    <div class="stardew-embed-animations">\n                        \x3c!-- 动画将由JS动态添加 --\x3e\n                    </div>\n                </div>\n            </div>\n        `}(t,a),async function(t,a){a.querySelector(".stardew-embed-sidebar");const n=a.querySelector(".stardew-embed-variants"),s=(a.querySelector(".stardew-embed-content"),a.querySelector(".stardew-embed-loading")),r=a.querySelector(".stardew-embed-animations");s.style.display="block",r.style.display="none";try{const a=await async function(e){const t=[{value:"Beach",label:"海滩"},{value:"Winter",label:"冬季"},{value:"JojaMart",label:"Joja超市"},{value:"Hospital",label:"医院"}],a=[];for(const n of t)try{(await fetch(`Animations/${e}_${n.value}.json`)).ok&&a.push(n)}catch(e){}return a}(t);if(a.length>0){for(;n.children.length>1;)n.removeChild(n.lastChild);a.forEach((a=>{const d=document.createElement("li");d.className="stardew-embed-variant-item",d.dataset.variant=a.value,d.textContent=a.label,n.appendChild(d),d.addEventListener("click",(async()=>{n.querySelectorAll(".stardew-embed-variant-item").forEach((e=>{e.classList.remove("active")})),d.classList.add("active"),s.style.display="block",r.style.display="none";const i=a.value?`${t}_${a.value}`:t;await e(i,r),s.style.display="none",r.style.display="flex"}))}))}const d=n.querySelector('.stardew-embed-variant-item[data-variant=""]');d&&d.addEventListener("click",(async()=>{n.querySelectorAll(".stardew-embed-variant-item").forEach((e=>{e.classList.remove("active")})),d.classList.add("active"),s.style.display="block",r.style.display="none",await e(t,r),s.style.display="none",r.style.display="flex"})),await e(t,r)}catch(e){console.error(`加载角色数据失败: ${e.message}`),r.innerHTML=`<div class="stardew-embed-error">加载角色 ${t} 失败: ${e.message}</div>`}finally{s.style.display="none",r.style.display="flex"}}(a,t)}(t)})):console.warn("未找到Stardew Valley角色播放器容器")}))}();